# AWL Component Interaction Diagram

```
┌─────────────────────────────────────────────────────────────────────────────────┐
│                                 AWL Application                                  │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│  ┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐            │
│  │   cmd/awl       │    │  cmd/awl-tray   │    │ cmd/gomobile-lib│            │
│  │   (Server)      │    │   (Desktop)     │    │   (Android)     │            │
│  └─────────────────┘    └─────────────────┘    └─────────────────┘            │
│           │                        │                        │                   │
│           └─────────────────┬──────────────────┬───────────────                │
│                            │                  │                                │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                     Application Struct                                 │   │
│  │  ┌─────────────┐ ┌─────────────┐ ┌─────────────┐ ┌─────────────┐     │   │
│  │  │ LogBuffer   │ │   Config    │ │  EventBus   │ │    API      │     │   │
│  │  │ (Logging)   │ │(Settings)   │ │ (Events)    │ │ (Web UI)    │     │   │
│  │  └─────────────┘ └─────────────┘ └─────────────┘ └─────────────┘     │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                      │                                         │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                          Core Services                                 │   │
│  │                                                                         │   │
│  │  ┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐    │   │
│  │  │   P2P Service   │    │  VPN Device     │    │  DNS Service    │    │   │
│  │  │                 │    │                 │    │                 │    │   │
│  │  │ • libp2p Host   │    │ • TUN Interface │    │ • .awl domains  │    │   │
│  │  │ • DHT Discovery │    │ • Packet I/O    │    │ • Name resolution│    │   │
│  │  │ • NAT Traversal │    │ • IP Routing    │    │ • DNS Server    │    │   │
│  │  │ • Relay Support │    │ • Platform Impl │    │ • Integration   │    │   │
│  │  └─────────────────┘    └─────────────────┘    └─────────────────┘    │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                      │                                         │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                      Application Services                               │   │
│  │                                                                         │   │
│  │  ┌─────────────────┐ ┌─────────────────┐ ┌─────────────────────────┐   │   │
│  │  │ Tunnel Service  │ │ SOCKS5 Service  │ │   AuthStatus Service    │   │   │
│  │  │                 │ │                 │ │                         │   │   │
│  │  │ • Packet Router │ │ • Proxy Server  │ │ • Peer Authentication   │   │   │
│  │  │ • Peer Mapping  │ │ • Traffic Relay │ │ • Friend Requests       │   │   │
│  │  │ • VPN Tunneling │ │ • Exit Node     │ │ • Status Exchange       │   │   │
│  │  └─────────────────┘ └─────────────────┘ └─────────────────────────┘   │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
│                                      │                                         │
│  ┌─────────────────────────────────────────────────────────────────────────┐   │
│  │                    Protocol & Communication                             │   │
│  │                                                                         │   │
│  │  ┌─────────────────────────────────────────────────────────────────┐   │   │
│  │  │                     Network Protocols                          │   │   │
│  │  │                                                                 │   │   │
│  │  │  ┌─────────────────┐  ┌─────────────────┐  ┌───────────────┐  │   │   │
│  │  │  │ GetStatusMethod │  │   AuthMethod    │  │ TunnelPacket  │  │   │   │
│  │  │  │                 │  │                 │  │    Method     │  │   │   │
│  │  │  └─────────────────┘  └─────────────────┘  └───────────────┘  │   │   │
│  │  │                                                                 │   │   │
│  │  │  ┌─────────────────┐                                           │   │   │
│  │  │  │ Socks5Packet    │                                           │   │   │
│  │  │  │    Method       │                                           │   │   │
│  │  │  └─────────────────┘                                           │   │   │
│  │  └─────────────────────────────────────────────────────────────────┘   │   │
│  └─────────────────────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────────────────────────┐
│                          External Dependencies                                  │
├─────────────────────────────────────────────────────────────────────────────────┤
│                                                                                 │
│ ┌─────────────────┐ ┌─────────────────┐ ┌─────────────────┐ ┌───────────────┐ │
│ │    libp2p       │ │   WireGuard     │ │  Bootstrap      │ │ System DNS    │ │
│ │                 │ │   TUN/Wintun    │ │    Nodes        │ │ Integration   │ │
│ │ • QUIC/TCP      │ │                 │ │                 │ │               │ │
│ │ • DHT           │ │ • Virtual IF    │ │ • Peer Discovery│ │ • Resolution  │ │
│ │ • Crypto        │ │ • Packet I/O    │ │ • Initial Conn  │ │ • Forwarding  │ │
│ │ • NAT Traversal │ │ • OS Integration│ │ • DHT Bootstrap │ │ • .awl domains│ │
│ └─────────────────┘ └─────────────────┘ └─────────────────┘ └───────────────┘ │
└─────────────────────────────────────────────────────────────────────────────────┘

                                Data Flow Diagram

Application Layer:
    ┌─────────────┐         ┌─────────────┐
    │ User Apps   │────────▶│ SOCKS5      │
    │ (Browser,   │         │ Proxy       │
    │  etc.)      │         │ (Port 8080) │
    └─────────────┘         └─────────────┘
                                    │
                                    ▼
Network Stack:     ┌─────────────────────────────────────┐
                   │         TUN Interface               │
                   │        (10.66.0.x/16)              │
                   └─────────────────────────────────────┘
                                    │
                                    ▼
VPN Layer:         ┌─────────────────────────────────────┐
                   │         VPN Device                  │
                   │    • Packet Capture                 │
                   │    • IP Routing                     │
                   │    • Checksum Calc                  │
                   └─────────────────────────────────────┘
                                    │
                                    ▼
Service Layer:     ┌─────────────────────────────────────┐
                   │       Tunnel Service                │
                   │   • Peer IP Mapping                 │
                   │   • Packet Routing                  │
                   │   • Stream Management               │
                   └─────────────────────────────────────┘
                                    │
                                    ▼
P2P Layer:         ┌─────────────────────────────────────┐
                   │         P2P Service                 │
                   │   • Connection Management           │
                   │   • Protocol Handling              │
                   │   • Transport Selection             │
                   └─────────────────────────────────────┘
                                    │
                                    ▼
Transport:         ┌─────────────────────────────────────┐
                   │    QUIC/TCP + TLS Streams           │
                   │   • Direct Connection               │
                   │   • Relay Connection                │
                   │   • NAT Traversal                   │
                   └─────────────────────────────────────┘
                                    │
                                    ▼
                           ┌─────────────────┐
                           │   Remote Peer   │
                           │   (Other AWL    │
                           │    Instance)    │
                           └─────────────────┘
```

## Event Flow Diagram

```
┌─────────────────┐
│   Configuration │
│     Change      │
└─────────┬───────┘
          │
          ▼
┌─────────────────┐      ┌─────────────────┐      ┌─────────────────┐
│   Event Bus     │────▶ │ Tunnel Service  │────▶ │   Peer List     │
│                 │      │                 │      │    Refresh      │
└─────────────────┘      └─────────────────┘      └─────────────────┘
          │
          ▼
┌─────────────────┐      ┌─────────────────┐
│ Auth Service    │────▶ │   UI Update     │
│                 │      │                 │
└─────────────────┘      └─────────────────┘
```

This diagram shows how the AWL application is structured with clear separation between different layers and how data flows through the system from user applications down to the transport layer and remote peers.